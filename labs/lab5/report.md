# Лабораторна робота №5 (Нормалізація)

### 1. Аналіз поточної схеми та виявлення аномалій

У ході аналізу DDL схеми було виявлено, що таблиця `users` містить атрибути, пов'язані з адресою проживання (`country`, `city`, `street`, `house_number`, `apartment_number`, `postal_code`).

**Виявлені проблеми:**
1. Порушення логіки 1:N (Business Rule): Користувач в реальній системі може мати декілька адрес (домашня, робоча, для батьків). Поточна схема дозволяє лише одну.
2. Транзитивна залежність (3NF): Існує залежність між поштовим індексом (`postal_code`) та містом/країною (`city`, `country`). Хоча це не сувора залежність (в різних країнах індекси працюють по-різному), логічно ці поля залежать від сутності "Місцезнаходження", а не безпосередньо від "Користувача".
3. Дублювання даних: Якщо два користувачі живуть в одній квартирі (сім'я), ми дублюємо всі адресні дані.

### 2. Функціональні залежності

**Таблиця users (Проблемна):**
1. id -> first_name, last_name, email, phone (Коректна залежність)
2. id -> postal_code
3. postal_code -> city, country (Транзитивна залежність: Адреса визначає місто, а не сам користувач).

### 3. Процес нормалізації
1. **Оцінка 1NF**: Всі атрибути мають бути атомарними. Статус: Таблиця `users` знаходиться в 1NF. Поля `street`, `city` тощо є атомарними значеннями, списків або масивів немає.
2. **Оцінка 2NF**: Відсутність часткових залежностей (для складених ключів). Статус: Первинний ключ `users` є простим (`id`). Отже, таблиця автоматично знаходиться в 2NF.
3. **Оцінка 3NF**: Відсутність транзитивних залежностей (неключовий атрибут не повинен залежати від іншого неключового атрибута).
   * Проблема: Атрибути адреси (`country`, `city`, `street`...) логічно утворюють окрему групу даних. Якщо ми змінимо `postal_code`, логічно можуть змінитися `city` та `country`.
   * Рішення: Декомпозиція. Ми виносимо адресу в окрему сутність `user_addresses`.

### 4. Перероблений дизайн (Декомпозиція)

Ми створюємо нову таблицю `user_addresses` і видаляємо адресні поля з `users`. Також ми повинні оновити таблицю `orders`, щоб замовлення посилалося не просто на користувача, а на конкретну адресу доставки цього користувача (адже користувач міг переїхати, а історія замовлень має зберегти стару адресу).

**Зміни**:
* `users`: Видаляємо `country`, `city`, `street`, `house_number`, `apartment_number`, `postal_code`.
* `user_addresses` (Нова таблиця): Додаємо всі видалені поля + `user_id` (FK) + `is_default` (прапорець основної адреси).
* `orders`: Додаємо `shipping_address_id`, який посилається на `user_addresses`.